# Internationalization (i18n) Strategy

Localization plan for multi-language support in DMO Knowledge Base.

---

## Current Status

**NOT IMPLEMENTED** - English only

**Planned**: Phased rollout for Japanese, Korean, Chinese Traditional

---

## Phase 1: Collection Localization

### Collections with Localized Fields

| Collection | Fields to Localize | Priority |
|------------|-------------------|----------|
| Digimon | `name`, `introduction`, `skills[].description` | High |
| Guides | `title`, `summary`, `content` | High |
| Quests | `title`, `steps[].description`, `rewards` | Medium |
| Maps | `name`, `notes` | Medium |
| Items | `name`, `description`, `effect` | Medium |
| Tools | `title`, `description` | Low |

### Payload Localization Config

**Update**: `apps/cms/src/payload.config.ts`

```typescript
export default buildConfig({
  localization: {
    locales: [
      {
        label: 'English',
        code: 'en',
      },
      {
        label: 'Êó•Êú¨Ë™û',
        code: 'ja',
      },
      {
        label: 'ÌïúÍµ≠Ïñ¥',
        code: 'ko',
      },
      {
        label: '‰∏≠Êñá',
        code: 'zh',
      },
    ],
    defaultLocale: 'en',
    fallback: true, // Use default locale if translation missing
  },
  // ...
});
```

### Collection Field Updates

**Example**: `apps/cms/src/collections/Digimon.ts`

```typescript
{
  name: 'name',
  type: 'text',
  required: true,
  localized: true, // ‚Üê Add this
},
{
  name: 'introduction',
  type: 'textarea',
  localized: true, // ‚Üê Add this
},
```

**Result**: Payload generates fields per locale:
- `name.en`: "Agumon"
- `name.ja`: "„Ç¢„Ç∞„É¢„É≥"
- `name.ko`: "ÏïÑÍµ¨Î™¨"
- `name.zh`: "‰∫ûÂè§Áç∏"

---

## Phase 2: Slug Localization Strategy

### Option A: Shared Slugs (Recommended)

**Single slug for all locales**: `/digimon/agumon`

**Pros**:
- Simpler routing
- Easier to share URLs
- Language switcher works seamlessly

**Cons**:
- Slug always in one language (usually English)

**Implementation**:
```typescript
// Slug NOT localized
{
  name: 'slug',
  type: 'text',
  unique: true,
  localized: false, // Same for all languages
}
```

### Option B: Localized Slugs

**Different slug per locale**:
- EN: `/digimon/agumon`
- JA: `/digimon/agumon` (romanized)
- KO: `/digimon/agumon` (romanized)

**Pros**:
- SEO benefit (URL in native language)
- More "native" feel

**Cons**:
- Complex routing
- URL sharing confusion
- Need locale detection

**Implementation**:
```typescript
{
  name: 'slug',
  type: 'text',
  unique: true,
  localized: true, // Different per language
}
```

**Recommendation**: Use **Option A** (shared slugs) for simplicity. Consider Option B later if SEO demands it.

---

## Phase 3: Frontend Localization

### Next.js i18n Setup

**Install**: `next-intl`

```bash
pnpm add next-intl
```

**Config**: `apps/web/src/i18n.ts`

```typescript
import { getRequestConfig } from 'next-intl/server';

export default getRequestConfig(async ({ locale }) => ({
  messages: (await import(`../messages/${locale}.json`)).default,
}));
```

**Middleware**: `apps/web/src/middleware.ts`

```typescript
import createMiddleware from 'next-intl/middleware';

export default createMiddleware({
  locales: ['en', 'ja', 'ko', 'zh'],
  defaultLocale: 'en',
  localePrefix: 'as-needed', // /en/digimon ‚Üí /digimon for default
});

export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)'],
};
```

### Route Structure

**Option 1: Locale in Path** (Recommended)

```
/en/digimon/agumon
/ja/digimon/agumon
/ko/digimon/agumon
/zh/digimon/agumon
```

**Option 2: Subdomain**

```
en.dmokb.com/digimon/agumon
ja.dmokb.com/digimon/agumon
```

**Option 3: Domain**

```
dmokb.com/digimon/agumon (EN)
dmokb.jp/digimon/agumon (JA)
```

**Recommendation**: Option 1 (path-based) for simplicity and single deployment.

---

## Phase 4: UI Translation

### Translation Files

**Structure**: `apps/web/messages/{locale}.json`

```
apps/web/
‚îú‚îÄ‚îÄ messages/
‚îÇ   ‚îú‚îÄ‚îÄ en.json
‚îÇ   ‚îú‚îÄ‚îÄ ja.json
‚îÇ   ‚îú‚îÄ‚îÄ ko.json
‚îÇ   ‚îî‚îÄ‚îÄ zh.json
```

**Example**: `messages/en.json`

```json
{
  "common": {
    "search": "Search",
    "loading": "Loading...",
    "error": "Error",
    "notFound": "Not Found"
  },
  "nav": {
    "home": "Home",
    "digimon": "Digimon",
    "guides": "Guides",
    "maps": "Maps"
  },
  "digimon": {
    "rank": "Rank",
    "element": "Element",
    "attribute": "Attribute",
    "stats": "Stats",
    "skills": "Skills"
  }
}
```

**Example**: `messages/ja.json`

```json
{
  "common": {
    "search": "Ê§úÁ¥¢",
    "loading": "Ë™≠„ÅøËæº„Åø‰∏≠...",
    "error": "„Ç®„É©„Éº",
    "notFound": "Ë¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"
  },
  "nav": {
    "home": "„Éõ„Éº„É†",
    "digimon": "„Éá„Ç∏„É¢„É≥",
    "guides": "„Ç¨„Ç§„Éâ",
    "maps": "„Éû„ÉÉ„Éó"
  },
  "digimon": {
    "rank": "„É©„É≥„ÇØ",
    "element": "Â±ûÊÄß",
    "attribute": "„Çø„Ç§„Éó",
    "stats": "„Çπ„ÉÜ„Éº„Çø„Çπ",
    "skills": "„Çπ„Ç≠„É´"
  }
}
```

### Component Usage

```typescript
import { useTranslations } from 'next-intl';

export function DigimonCard({ digimon }) {
  const t = useTranslations('digimon');
  
  return (
    <div>
      <p>{t('rank')}: {digimon.rank}</p>
      <p>{t('element')}: {digimon.element}</p>
    </div>
  );
}
```

---

## Phase 5: Language Switcher

### UI Component

**File**: `apps/web/src/components/layout/language-switcher.tsx`

```typescript
'use client';

import { useLocale } from 'next-intl';
import { useRouter, usePathname } from 'next/navigation';

const locales = [
  { code: 'en', label: 'English', flag: 'üá∫üá∏' },
  { code: 'ja', label: 'Êó•Êú¨Ë™û', flag: 'üáØüáµ' },
  { code: 'ko', label: 'ÌïúÍµ≠Ïñ¥', flag: 'üá∞üá∑' },
  { code: 'zh', label: '‰∏≠Êñá', flag: 'üá®üá≥' },
];

export function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();
  
  const switchLocale = (newLocale: string) => {
    // Replace current locale in path
    const newPath = pathname.replace(`/${locale}`, `/${newLocale}`);
    router.push(newPath);
  };
  
  return (
    <select value={locale} onChange={(e) => switchLocale(e.target.value)}>
      {locales.map((loc) => (
        <option key={loc.code} value={loc.code}>
          {loc.flag} {loc.label}
        </option>
      ))}
    </select>
  );
}
```

### Placement

- Header (top-right)
- Footer
- User settings page

---

## Locale Detection Strategy

### Priority Order

1. **User preference** (stored in cookie/localStorage)
2. **URL locale** (`/ja/digimon`)
3. **Accept-Language header** (browser setting)
4. **Default locale** (`en`)

### Implementation

```typescript
// apps/web/src/middleware.ts
import { match } from '@formatjs/intl-localematcher';
import Negotiator from 'negotiator';

function getLocale(request: Request): string {
  // Check cookie
  const cookieLocale = request.cookies.get('NEXT_LOCALE')?.value;
  if (cookieLocale && supportedLocales.includes(cookieLocale)) {
    return cookieLocale;
  }
  
  // Check Accept-Language
  const headers = { 'accept-language': request.headers.get('accept-language') || '' };
  const languages = new Negotiator({ headers }).languages();
  
  return match(languages, supportedLocales, defaultLocale);
}
```

---

## Content Translation Workflow

### Initial Translation

1. **Content created in English** (default locale)
2. **Editor exports** content via Payload API
3. **Send to translators** (or use service like Lokalise, Crowdin)
4. **Translators** fill locale-specific fields
5. **Import back** to Payload
6. **Publish** translated versions

### Ongoing Translation

**Payload Admin**:
- Switch locale dropdown in admin UI
- Edit fields for each locale
- Mark translations as "needs review"

**Fallback**:
- If translation missing ‚Üí show English version
- Display "View in English" badge

---

## SEO Considerations

### Hreflang Tags

Add to every page:

```html
<link rel="alternate" hreflang="en" href="https://dmokb.com/digimon/agumon" />
<link rel="alternate" hreflang="ja" href="https://dmokb.com/ja/digimon/agumon" />
<link rel="alternate" hreflang="ko" href="https://dmokb.com/ko/digimon/agumon" />
<link rel="alternate" hreflang="zh" href="https://dmokb.com/zh/digimon/agumon" />
<link rel="alternate" hreflang="x-default" href="https://dmokb.com/digimon/agumon" />
```

**Implementation**:

```typescript
// apps/web/src/app/[locale]/digimon/[slug]/page.tsx
export async function generateMetadata({ params }) {
  return {
    alternates: {
      languages: {
        'en': `/en/digimon/${params.slug}`,
        'ja': `/ja/digimon/${params.slug}`,
        'ko': `/ko/digimon/${params.slug}`,
        'zh': `/zh/digimon/${params.slug}`,
      },
    },
  };
}
```

### Sitemap

Generate per-locale sitemaps:
- `/sitemap-en.xml`
- `/sitemap-ja.xml`
- `/sitemap-ko.xml`
- `/sitemap-zh.xml`

---

## Database Considerations

### Storage Impact

**Localized field** `name` with 4 locales:
- Before: 1 field √ó 1000 Digimon = 1000 fields
- After: 4 fields √ó 1000 Digimon = 4000 fields

**Disk space**: ~3-4x increase (acceptable for text fields)

### Query Performance

**Fetch specific locale**:
```javascript
db.digimon.find({ 'name.en': 'Agumon' })
```

**Index per locale**:
```javascript
db.digimon.createIndex({ 'name.en': 1 });
db.digimon.createIndex({ 'name.ja': 1 });
// ... etc
```

---

## Rollout Plan

### Week 1: Foundation

- [ ] Enable Payload localization config
- [ ] Add `localized: true` to priority fields (Digimon name/intro)
- [ ] Install next-intl
- [ ] Create basic UI translation files

### Week 2: Frontend i18n

- [ ] Set up next-intl middleware
- [ ] Add locale to routes (`/[locale]/...`)
- [ ] Implement language switcher
- [ ] Translate common UI strings

### Week 3: Content Translation

- [ ] Translate ~50 Digimon (top viewed)
- [ ] Translate 10 guides
- [ ] Test fallback behavior
- [ ] Add "Translate this page" contribution button

### Month 2: Full Rollout

- [ ] Translate all Digimon
- [ ] Translate all guides
- [ ] Add hreflang tags
- [ ] Generate localized sitemaps
- [ ] Marketing announcement

---

## Translation Services

### Option 1: Manual (Free)

- Community volunteers
- Google Docs for collaboration
- Export/import via scripts

### Option 2: Platform (Paid)

**Lokalise** or **Crowdin**:
- Import content via API
- Translators work in web UI
- Export back to Payload
- ~$100-200/month

### Option 3: Machine Translation (Initial)

**Google Translate API** for draft:
- Auto-translate on create
- Mark as "machine translated"
- Community can improve
- ~$20 per 1M characters

---

## Testing

### Locale Switching

```typescript
// apps/web/tests/e2e/i18n.spec.ts
test('switches language', async ({ page }) => {
  await page.goto('/digimon/agumon');
  await page.selectOption('[data-testid="language-switcher"]', 'ja');
  
  await expect(page).toHaveURL('/ja/digimon/agumon');
  await expect(page.locator('h1')).toContainText('„Ç¢„Ç∞„É¢„É≥');
});
```

### Fallback Behavior

```typescript
test('shows English when translation missing', async ({ page }) => {
  await page.goto('/ja/digimon/new-digimon-without-translation');
  
  // Should show English content + badge
  await expect(page.locator('[data-testid="fallback-badge"]')).toBeVisible();
});
```

---

## Resources

- [Payload Localization](https://payloadcms.com/docs/configuration/localization)
- [next-intl Docs](https://next-intl-docs.vercel.app/)
- [i18n Best Practices](https://developers.google.com/search/docs/specialty/international)
